name: Security Reports to GitHub Pages

on:
  # Ejecutar despu√©s del workflow principal
  workflow_run:
    workflows: ["Complete Test Suite"]
    types:
      - completed
    branches:
      - main
  
  # Ejecutar manualmente
  workflow_dispatch:
  
  # Ejecutar semanalmente para mantener reportes actualizados
  schedule:
    - cron: '0 3 * * 1'  # Lunes a las 3 AM

permissions:
  contents: write
  pages: write
  id-token: write

# Permitir solo una ejecuci√≥n concurrente
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  generate-security-reports:
    name: Generate Security Reports
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install SARIF tools
        run: |
          pip install sarif-tools jinja2
          npm install -g @microsoft/sarif-multitool
      
      # ============================================
      # SEMGREP ANALYSIS
      # ============================================
      - name: Run Semgrep Analysis
        id: semgrep
        continue-on-error: true
        run: |
          pip install semgrep
          
          # Ejecutar an√°lisis con m√∫ltiples rulesets
          semgrep scan \
            --config "p/java" \
            --config "p/owasp-top-ten" \
            --config "p/security-audit" \
            --config "p/sql-injection" \
            --config "p/xss" \
            --config "p/insecure-transport" \
            --sarif \
            --output semgrep-results.sarif \
            proyecto/src/ || true
          
          # Tambi√©n generar JSON para procesamiento
          semgrep scan \
            --config "p/java" \
            --config "p/owasp-top-ten" \
            --config "p/security-audit" \
            --config "p/sql-injection" \
            --config "p/xss" \
            --config "p/insecure-transport" \
            --json \
            --output semgrep-results.json \
            proyecto/src/ || true
          
          echo "Semgrep analysis completed"
      
      # ============================================
      # SONARCLOUD ANALYSIS
      # ============================================
      - name: Run SonarCloud Analysis
        id: sonarcloud
        continue-on-error: true
        uses: SonarSource/sonarcloud-github-action@v3
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      
      - name: Wait for SonarCloud Processing
        run: sleep 30
      
      - name: Download SonarCloud Results
        continue-on-error: true
        run: |
          # Obtener los issues de SonarCloud v√≠a API
          curl -u "${{ secrets.SONAR_TOKEN }}:" \
            "https://sonarcloud.io/api/issues/search?componentKeys=upt-epis_voluntariado-upt&ps=500" \
            -o sonarcloud-issues.json
          
          # Obtener medidas del proyecto
          curl -u "${{ secrets.SONAR_TOKEN }}:" \
            "https://sonarcloud.io/api/measures/component?component=upt-epis_voluntariado-upt&metricKeys=bugs,vulnerabilities,code_smells,security_hotspots,coverage,duplicated_lines_density,ncloc,sqale_index,reliability_rating,security_rating,sqale_rating" \
            -o sonarcloud-measures.json
      
      # ============================================
      # SNYK ANALYSIS
      # ============================================
      - name: Run Snyk Analysis
        id: snyk
        continue-on-error: true
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        run: |
          npm install -g snyk
          
          cd proyecto
          
          # Autenticar con Snyk
          snyk auth ${{ secrets.SNYK_TOKEN }}
          
          # Test de vulnerabilidades en dependencias
          snyk test \
            --all-projects \
            --severity-threshold=low \
            --json \
            --json-file-output=../snyk-test-results.json || true
          
          # Test de vulnerabilidades en c√≥digo
          snyk code test \
            --sarif \
            --sarif-file-output=../snyk-code-results.sarif || true
          
          # Monitor proyecto en Snyk dashboard
          snyk monitor --all-projects || true
          
          cd ..
          
          echo "Snyk analysis completed"
      
      # ============================================
      # DOWNLOAD PITEST MUTATION REPORTS
      # ============================================
      - name: Download PITest Mutation Reports
        id: pitest
        continue-on-error: true
        uses: dawidd6/action-download-artifact@v3
        with:
          workflow: complete-test-suite.yml
          name: mutation-test-results
          path: pitest-reports/
          if_no_artifact_found: warn
      
      - name: List downloaded PITest artifacts
        continue-on-error: true
        run: |
          echo "Checking for PITest reports..."
          if [ -d pitest-reports ]; then
            ls -la pitest-reports/
            find pitest-reports -type f -name "*.html" | head -5
          else
            echo "No PITest reports found - artifact may not exist yet"
          fi
      
      # ============================================
      # DOWNLOAD BDD (CUCUMBER) REPORTS
      # ============================================
      - name: Download BDD Test Reports (Smoke)
        id: bdd-smoke
        continue-on-error: true
        uses: dawidd6/action-download-artifact@v3
        with:
          workflow: complete-test-suite.yml
          name: bdd-test-results-smoke
          path: bdd-reports/smoke/
          if_no_artifact_found: warn
      
      - name: Download BDD Test Reports (Regression)
        id: bdd-regression
        continue-on-error: true
        uses: dawidd6/action-download-artifact@v3
        with:
          workflow: complete-test-suite.yml
          name: bdd-test-results-regression
          path: bdd-reports/regression/
          if_no_artifact_found: warn
      
      - name: List downloaded BDD artifacts
        continue-on-error: true
        run: |
          echo "Checking for BDD reports..."
          if [ -d bdd-reports ]; then
            echo "Smoke tests:"
            ls -la bdd-reports/smoke/ || echo "No smoke reports"
            echo "Regression tests:"
            ls -la bdd-reports/regression/ || echo "No regression reports"
            find bdd-reports -type f -name "*.html" | head -10
          else
            echo "No BDD reports found - artifact may not exist yet"
          fi
      
      # ============================================
      # GENERATE HTML REPORTS
      # ============================================
      - name: Generate HTML Reports
        run: |
          mkdir -p reports/semgrep reports/snyk reports/sonarcloud reports/pitest reports/bdd
          
          # Crear script de conversi√≥n SARIF a HTML
          cat > convert-sarif-to-html.py << 'EOF'
          import json
          import sys
          from datetime import datetime
          from pathlib import Path
          
          def sarif_to_html(sarif_file, output_file, tool_name):
              with open(sarif_file, 'r', encoding='utf-8') as f:
                  sarif_data = json.load(f)
              
              runs = sarif_data.get('runs', [])
              if not runs:
                  print(f"No runs found in {sarif_file}")
                  return
              
              run = runs[0]
              results = run.get('results', [])
              tool_info = run.get('tool', {}).get('driver', {})
              
              # Contar severidades
              severity_counts = {'error': 0, 'warning': 0, 'note': 0}
              for result in results:
                  level = result.get('level', 'warning')
                  severity_counts[level] = severity_counts.get(level, 0) + 1
              
              # Generar HTML
              html = f'''<!DOCTYPE html>
          <html lang="es">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>{tool_name} Security Report</title>
              <style>
                  * {{
                      margin: 0;
                      padding: 0;
                      box-sizing: border-box;
                  }}
                  body {{
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      padding: 20px;
                      color: #333;
                  }}
                  .container {{
                      max-width: 1400px;
                      margin: 0 auto;
                      background: white;
                      border-radius: 12px;
                      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                      overflow: hidden;
                  }}
                  .header {{
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      padding: 40px;
                      text-align: center;
                  }}
                  .header h1 {{
                      font-size: 2.5em;
                      margin-bottom: 10px;
                  }}
                  .header p {{
                      opacity: 0.9;
                      font-size: 1.1em;
                  }}
                  .stats {{
                      display: grid;
                      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                      gap: 20px;
                      padding: 30px;
                      background: #f8f9fa;
                  }}
                  .stat-card {{
                      background: white;
                      padding: 25px;
                      border-radius: 8px;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                      text-align: center;
                      transition: transform 0.2s;
                  }}
                  .stat-card:hover {{
                      transform: translateY(-5px);
                      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
                  }}
                  .stat-number {{
                      font-size: 3em;
                      font-weight: bold;
                      margin-bottom: 10px;
                  }}
                  .stat-label {{
                      color: #666;
                      text-transform: uppercase;
                      font-size: 0.9em;
                      letter-spacing: 1px;
                  }}
                  .error {{ color: #dc3545; }}
                  .warning {{ color: #ffc107; }}
                  .note {{ color: #17a2b8; }}
                  .results {{
                      padding: 30px;
                  }}
                  .result-item {{
                      background: #f8f9fa;
                      border-left: 4px solid #ccc;
                      padding: 20px;
                      margin-bottom: 20px;
                      border-radius: 4px;
                      transition: all 0.3s;
                  }}
                  .result-item:hover {{
                      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                      transform: translateX(5px);
                  }}
                  .result-item.error {{
                      border-left-color: #dc3545;
                      background: #fff5f5;
                  }}
                  .result-item.warning {{
                      border-left-color: #ffc107;
                      background: #fffbf0;
                  }}
                  .result-item.note {{
                      border-left-color: #17a2b8;
                      background: #f0f9ff;
                  }}
                  .result-header {{
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      margin-bottom: 15px;
                      flex-wrap: wrap;
                      gap: 10px;
                  }}
                  .result-title {{
                      font-size: 1.2em;
                      font-weight: 600;
                      color: #2c3e50;
                  }}
                  .result-severity {{
                      padding: 5px 15px;
                      border-radius: 20px;
                      font-size: 0.85em;
                      font-weight: bold;
                      text-transform: uppercase;
                  }}
                  .severity-error {{
                      background: #dc3545;
                      color: white;
                  }}
                  .severity-warning {{
                      background: #ffc107;
                      color: #333;
                  }}
                  .severity-note {{
                      background: #17a2b8;
                      color: white;
                  }}
                  .result-message {{
                      color: #555;
                      line-height: 1.6;
                      margin-bottom: 15px;
                  }}
                  .result-location {{
                      background: white;
                      padding: 15px;
                      border-radius: 4px;
                      font-family: 'Courier New', monospace;
                      font-size: 0.9em;
                      overflow-x: auto;
                  }}
                  .location-path {{
                      color: #667eea;
                      font-weight: bold;
                      margin-bottom: 5px;
                  }}
                  .location-line {{
                      color: #666;
                  }}
                  .code-snippet {{
                      background: #2d2d2d;
                      color: #f8f8f2;
                      padding: 15px;
                      border-radius: 4px;
                      overflow-x: auto;
                      margin-top: 10px;
                      font-family: 'Courier New', monospace;
                      font-size: 0.85em;
                  }}
                  .footer {{
                      background: #2c3e50;
                      color: white;
                      padding: 20px;
                      text-align: center;
                  }}
                  .back-button {{
                      display: inline-block;
                      margin: 20px;
                      padding: 12px 30px;
                      background: #667eea;
                      color: white;
                      text-decoration: none;
                      border-radius: 6px;
                      transition: background 0.3s;
                      font-weight: 600;
                  }}
                  .back-button:hover {{
                      background: #764ba2;
                  }}
                  .no-results {{
                      text-align: center;
                      padding: 60px 20px;
                      color: #28a745;
                      font-size: 1.5em;
                  }}
                  .no-results svg {{
                      width: 100px;
                      height: 100px;
                      margin-bottom: 20px;
                  }}
              </style>
          </head>
          <body>
              <div class="container">
                  <div class="header">
                      <h1>üîí {tool_name} Security Report</h1>
                      <p>Sistema de Voluntariado UPT - An√°lisis de Seguridad</p>
                      <p>Generado: {datetime.now().strftime("%Y-%m-%d %H:%M:%S UTC")}</p>
                  </div>
                  
                  <div class="stats">
                      <div class="stat-card">
                          <div class="stat-number error">{severity_counts.get('error', 0)}</div>
                          <div class="stat-label">Errores Cr√≠ticos</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number warning">{severity_counts.get('warning', 0)}</div>
                          <div class="stat-label">Advertencias</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number note">{severity_counts.get('note', 0)}</div>
                          <div class="stat-label">Notas</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number">{len(results)}</div>
                          <div class="stat-label">Total Issues</div>
                      </div>
                  </div>
                  
                  <a href="../index.html" class="back-button">‚Üê Volver al Dashboard</a>
                  
                  <div class="results">
          '''
              
              if not results:
                  html += '''
                      <div class="no-results">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                          </svg>
                          <div>‚úÖ ¬°Excelente! No se encontraron problemas de seguridad.</div>
                      </div>
                  '''
              else:
                  for idx, result in enumerate(results, 1):
                      level = result.get('level', 'warning')
                      rule_id = result.get('ruleId', 'Unknown')
                      message = result.get('message', {}).get('text', 'No message')
                      
                      locations = result.get('locations', [])
                      location_html = ''
                      if locations:
                          loc = locations[0].get('physicalLocation', {})
                          artifact = loc.get('artifactLocation', {}).get('uri', 'Unknown')
                          region = loc.get('region', {})
                          start_line = region.get('startLine', '?')
                          
                          location_html = f'''
                          <div class="result-location">
                              <div class="location-path">üìÅ {artifact}</div>
                              <div class="location-line">üìç L√≠nea {start_line}</div>
                          </div>
                          '''
                          
                          # Agregar snippet de c√≥digo si existe
                          snippet = region.get('snippet', {}).get('text', '')
                          if snippet:
                              location_html += f'''
                              <div class="code-snippet">{snippet.strip()}</div>
                              '''
                      
                      html += f'''
                      <div class="result-item {level}">
                          <div class="result-header">
                              <div class="result-title">#{idx}: {rule_id}</div>
                              <span class="result-severity severity-{level}">{level}</span>
                          </div>
                          <div class="result-message">{message}</div>
                          {location_html}
                      </div>
                      '''
              
              html += '''
                  </div>
                  
                  <div class="footer">
                      <p>Reportes generados autom√°ticamente por GitHub Actions</p>
                      <p>Universidad Privada de Tacna - FAING EPIS</p>
                  </div>
              </div>
          </body>
          </html>
              '''
              
              with open(output_file, 'w', encoding='utf-8') as f:
                  f.write(html)
              
              print(f"HTML report generated: {output_file}")
          
          if __name__ == '__main__':
              if len(sys.argv) != 4:
                  print("Usage: python convert-sarif-to-html.py <sarif_file> <output_file> <tool_name>")
                  sys.exit(1)
              
              sarif_to_html(sys.argv[1], sys.argv[2], sys.argv[3])
          EOF
          
          # Convertir Semgrep SARIF a HTML
          if [ -f semgrep-results.sarif ]; then
            python convert-sarif-to-html.py semgrep-results.sarif reports/semgrep/index.html "Semgrep"
            cp semgrep-results.sarif reports/semgrep/
            cp semgrep-results.json reports/semgrep/
          fi
          
          # Convertir Snyk Code SARIF a HTML
          if [ -f snyk-code-results.sarif ]; then
            python convert-sarif-to-html.py snyk-code-results.sarif reports/snyk/code.html "Snyk Code"
            cp snyk-code-results.sarif reports/snyk/
          fi
          
          # Generar reporte HTML de SonarCloud desde JSON
          if [ -f sonarcloud-issues.json ] && [ -f sonarcloud-measures.json ]; then
            cat > convert-sonarcloud-to-html.py << 'EOFSONAR'
          import json
          from datetime import datetime
          
          # Leer datos de SonarCloud
          with open('sonarcloud-issues.json', 'r', encoding='utf-8') as f:
              issues_data = json.load(f)
          
          with open('sonarcloud-measures.json', 'r', encoding='utf-8') as f:
              measures_data = json.load(f)
          
          issues = issues_data.get('issues', [])
          measures = {m['metric']: m.get('value', '0') for m in measures_data.get('component', {}).get('measures', [])}
          
          # Contar por tipo y severidad
          type_counts = {}
          severity_counts = {'BLOCKER': 0, 'CRITICAL': 0, 'MAJOR': 0, 'MINOR': 0, 'INFO': 0}
          
          for issue in issues:
              issue_type = issue.get('type', 'UNKNOWN')
              severity = issue.get('severity', 'INFO')
              type_counts[issue_type] = type_counts.get(issue_type, 0) + 1
              severity_counts[severity] = severity_counts.get(severity, 0) + 1
          
          html = f'''<!DOCTYPE html>
          <html lang="es">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>SonarCloud Analysis Report</title>
              <style>
                  * {{ margin: 0; padding: 0; box-sizing: border-box; }}
                  body {{
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
                      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
                      padding: 20px;
                      color: #333;
                  }}
                  .container {{
                      max-width: 1400px;
                      margin: 0 auto;
                      background: white;
                      border-radius: 12px;
                      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                      overflow: hidden;
                  }}
                  .header {{
                      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
                      color: white;
                      padding: 40px;
                      text-align: center;
                  }}
                  .header h1 {{ font-size: 2.5em; margin-bottom: 10px; }}
                  .stats {{
                      display: grid;
                      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                      gap: 20px;
                      padding: 30px;
                      background: #f8f9fa;
                  }}
                  .stat-card {{
                      background: white;
                      padding: 25px;
                      border-radius: 8px;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                      text-align: center;
                  }}
                  .stat-number {{ font-size: 2.5em; font-weight: bold; margin-bottom: 10px; }}
                  .stat-label {{ color: #666; font-size: 0.95em; text-transform: uppercase; }}
                  .blocker {{ color: #d32f2f; }}
                  .critical {{ color: #f44336; }}
                  .major {{ color: #ff9800; }}
                  .minor {{ color: #ffc107; }}
                  .info {{ color: #2196f3; }}
                  .issues-list {{
                      padding: 30px;
                  }}
                  .issue-card {{
                      background: #f8f9fa;
                      padding: 20px;
                      margin-bottom: 15px;
                      border-radius: 8px;
                      border-left: 4px solid #666;
                  }}
                  .issue-card.blocker {{ border-left-color: #d32f2f; }}
                  .issue-card.critical {{ border-left-color: #f44336; }}
                  .issue-card.major {{ border-left-color: #ff9800; }}
                  .issue-card.minor {{ border-left-color: #ffc107; }}
                  .issue-card.info {{ border-left-color: #2196f3; }}
                  .issue-severity {{
                      display: inline-block;
                      padding: 4px 12px;
                      border-radius: 4px;
                      font-size: 0.85em;
                      font-weight: bold;
                      margin-right: 10px;
                  }}
                  .footer {{
                      background: #f8f9fa;
                      padding: 20px;
                      text-align: center;
                      color: #666;
                  }}
              </style>
          </head>
          <body>
              <div class="container">
                  <div class="header">
                      <h1>üîç SonarCloud Analysis Report</h1>
                      <p>Generated on {datetime.now().strftime("%Y-%m-%d %H:%M:%S")}</p>
                      <p><a href="https://sonarcloud.io/project/overview?id=upt-epis_voluntariado-upt" style="color: white; text-decoration: underline;">Ver en SonarCloud</a></p>
                  </div>
                  
                  <div class="stats">
                      <div class="stat-card">
                          <div class="stat-number">{measures.get('bugs', '0')}</div>
                          <div class="stat-label">Bugs</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number">{measures.get('vulnerabilities', '0')}</div>
                          <div class="stat-label">Vulnerabilities</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number">{measures.get('code_smells', '0')}</div>
                          <div class="stat-label">Code Smells</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number">{measures.get('security_hotspots', '0')}</div>
                          <div class="stat-label">Security Hotspots</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number">{measures.get('ncloc', 'N/A')}</div>
                          <div class="stat-label">Lines of Code</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number">{measures.get('duplicated_lines_density', '0')}%</div>
                          <div class="stat-label">Duplicated Lines</div>
                      </div>
                  </div>
                  
                  <div class="stats">
                      <div class="stat-card">
                          <div class="stat-number blocker">{severity_counts['BLOCKER']}</div>
                          <div class="stat-label">Blocker</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number critical">{severity_counts['CRITICAL']}</div>
                          <div class="stat-label">Critical</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number major">{severity_counts['MAJOR']}</div>
                          <div class="stat-label">Major</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number minor">{severity_counts['MINOR']}</div>
                          <div class="stat-label">Minor</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number info">{severity_counts['INFO']}</div>
                          <div class="stat-label">Info</div>
                      </div>
                  </div>
                  
                  <div class="issues-list">
                      <h2 style="margin-bottom: 20px;">üìã Issues Encontrados ({len(issues)})</h2>
          '''
          
          for issue in issues[:100]:  # Mostrar los primeros 100 issues
              severity = issue.get('severity', 'INFO')
              message = issue.get('message', 'No message')
              component = issue.get('component', '').replace('upt-epis_voluntariado-upt:', '')
              rule = issue.get('rule', '')
              line = issue.get('line', 'N/A')
              
              html += f'''
                      <div class="issue-card {severity.lower()}">
                          <div>
                              <span class="issue-severity" style="background: {'#d32f2f' if severity == 'BLOCKER' else '#f44336' if severity == 'CRITICAL' else '#ff9800' if severity == 'MAJOR' else '#ffc107' if severity == 'MINOR' else '#2196f3'}; color: white;">{severity}</span>
                              <strong>{issue.get('type', 'UNKNOWN')}</strong>
                          </div>
                          <p style="margin: 10px 0;"><strong>{message}</strong></p>
                          <p style="color: #666; font-size: 0.9em;">
                              üìÑ {component} ‚Ä¢ Line {line}<br>
                              üîß Rule: {rule}
                          </p>
                      </div>
          '''
          
          if len(issues) > 100:
              html += f'<p style="text-align: center; color: #666; padding: 20px;">Y {len(issues) - 100} issues m√°s... <a href="https://sonarcloud.io/project/issues?id=upt-epis_voluntariado-upt">Ver todos en SonarCloud</a></p>'
          
          html += '''
                  </div>
                  
                  <div class="footer">
                      <p>Generated by SonarCloud Analysis ‚Ä¢ Sistema Voluntariado UPT</p>
                  </div>
              </div>
          </body>
          </html>
          '''
          
          with open('reports/sonarcloud/index.html', 'w', encoding='utf-8') as f:
              f.write(html)
          
          print("SonarCloud HTML report generated successfully")
          EOFSONAR
            
            python convert-sonarcloud-to-html.py
            cp sonarcloud-*.json reports/sonarcloud/
          fi
          
          # Generar reporte HTML de Snyk Test desde JSON
          if [ -f snyk-test-results.json ]; then
            cat > convert-snyk-json-to-html.py << 'EOFPY'
          import json
          from datetime import datetime
          
          with open('snyk-test-results.json', 'r', encoding='utf-8') as f:
              data = json.load(f)
          
          vulnerabilities = data.get('vulnerabilities', [])
          
          # Contar severidades
          severity_counts = {'critical': 0, 'high': 0, 'medium': 0, 'low': 0}
          for vuln in vulnerabilities:
              severity = vuln.get('severity', 'low').lower()
              severity_counts[severity] = severity_counts.get(severity, 0) + 1
          
          html = f'''<!DOCTYPE html>
          <html lang="es">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Snyk Dependency Vulnerabilities Report</title>
              <style>
                  * {{ margin: 0; padding: 0; box-sizing: border-box; }}
                  body {{
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      padding: 20px;
                      color: #333;
                  }}
                  .container {{
                      max-width: 1400px;
                      margin: 0 auto;
                      background: white;
                      border-radius: 12px;
                      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                      overflow: hidden;
                  }}
                  .header {{
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      padding: 40px;
                      text-align: center;
                  }}
                  .header h1 {{ font-size: 2.5em; margin-bottom: 10px; }}
                  .header p {{ opacity: 0.9; font-size: 1.1em; }}
                  .stats {{
                      display: grid;
                      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                      gap: 20px;
                      padding: 30px;
                      background: #f8f9fa;
                  }}
                  .stat-card {{
                      background: white;
                      padding: 25px;
                      border-radius: 8px;
                      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                      text-align: center;
                      transition: transform 0.2s;
                  }}
                  .stat-card:hover {{
                      transform: translateY(-5px);
                      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
                  }}
                  .stat-number {{ font-size: 3em; font-weight: bold; margin-bottom: 10px; }}
                  .stat-label {{ color: #666; text-transform: uppercase; font-size: 0.9em; letter-spacing: 1px; }}
                  .critical {{ color: #8b0000; }}
                  .high {{ color: #dc3545; }}
                  .medium {{ color: #ffc107; }}
                  .low {{ color: #17a2b8; }}
                  .results {{ padding: 30px; }}
                  .result-item {{
                      background: #f8f9fa;
                      border-left: 4px solid #ccc;
                      padding: 20px;
                      margin-bottom: 20px;
                      border-radius: 4px;
                      transition: all 0.3s;
                  }}
                  .result-item:hover {{
                      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                      transform: translateX(5px);
                  }}
                  .result-item.critical {{ border-left-color: #8b0000; background: #fff0f0; }}
                  .result-item.high {{ border-left-color: #dc3545; background: #fff5f5; }}
                  .result-item.medium {{ border-left-color: #ffc107; background: #fffbf0; }}
                  .result-item.low {{ border-left-color: #17a2b8; background: #f0f9ff; }}
                  .result-header {{
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      margin-bottom: 15px;
                      flex-wrap: wrap;
                      gap: 10px;
                  }}
                  .result-title {{ font-size: 1.2em; font-weight: 600; color: #2c3e50; }}
                  .result-severity {{
                      padding: 5px 15px;
                      border-radius: 20px;
                      font-size: 0.85em;
                      font-weight: bold;
                      text-transform: uppercase;
                  }}
                  .severity-critical {{ background: #8b0000; color: white; }}
                  .severity-high {{ background: #dc3545; color: white; }}
                  .severity-medium {{ background: #ffc107; color: #333; }}
                  .severity-low {{ background: #17a2b8; color: white; }}
                  .result-description {{ color: #555; line-height: 1.6; margin-bottom: 15px; }}
                  .result-info {{
                      background: white;
                      padding: 15px;
                      border-radius: 4px;
                      font-size: 0.9em;
                  }}
                  .info-item {{ margin-bottom: 8px; }}
                  .info-label {{ font-weight: bold; color: #667eea; }}
                  .footer {{
                      background: #2c3e50;
                      color: white;
                      padding: 20px;
                      text-align: center;
                  }}
                  .back-button {{
                      display: inline-block;
                      margin: 20px;
                      padding: 12px 30px;
                      background: #667eea;
                      color: white;
                      text-decoration: none;
                      border-radius: 6px;
                      transition: background 0.3s;
                      font-weight: 600;
                  }}
                  .back-button:hover {{ background: #764ba2; }}
                  .no-results {{
                      text-align: center;
                      padding: 60px 20px;
                      color: #28a745;
                      font-size: 1.5em;
                  }}
              </style>
          </head>
          <body>
              <div class="container">
                  <div class="header">
                      <h1>üõ°Ô∏è Snyk Dependency Vulnerabilities</h1>
                      <p>Sistema de Voluntariado UPT - An√°lisis de Dependencias</p>
                      <p>Generado: {datetime.now().strftime("%Y-%m-%d %H:%M:%S UTC")}</p>
                  </div>
                  
                  <div class="stats">
                      <div class="stat-card">
                          <div class="stat-number critical">{severity_counts.get('critical', 0)}</div>
                          <div class="stat-label">Cr√≠ticas</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number high">{severity_counts.get('high', 0)}</div>
                          <div class="stat-label">Altas</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number medium">{severity_counts.get('medium', 0)}</div>
                          <div class="stat-label">Medias</div>
                      </div>
                      <div class="stat-card">
                          <div class="stat-number low">{severity_counts.get('low', 0)}</div>
                          <div class="stat-label">Bajas</div>
                      </div>
                  </div>
                  
                  <a href="../index.html" class="back-button">‚Üê Volver al Dashboard</a>
                  
                  <div class="results">
          '''
          
          if not vulnerabilities:
              html += '<div class="no-results">‚úÖ ¬°Excelente! No se encontraron vulnerabilidades en las dependencias.</div>'
          else:
              for idx, vuln in enumerate(vulnerabilities, 1):
                  severity = vuln.get('severity', 'low').lower()
                  title = vuln.get('title', 'Unknown vulnerability')
                  package_name = vuln.get('packageName', 'Unknown package')
                  version = vuln.get('version', '?')
                  cve = vuln.get('identifiers', {}).get('CVE', ['N/A'])[0] if vuln.get('identifiers', {}).get('CVE') else 'N/A'
                  description = vuln.get('description', 'No description available')
                  
                  html += f'''
                  <div class="result-item {severity}">
                      <div class="result-header">
                          <div class="result-title">#{idx}: {title}</div>
                          <span class="result-severity severity-{severity}">{severity}</span>
                      </div>
                      <div class="result-description">{description}</div>
                      <div class="result-info">
                          <div class="info-item"><span class="info-label">üì¶ Package:</span> {package_name}@{version}</div>
                          <div class="info-item"><span class="info-label">üîñ CVE:</span> {cve}</div>
                      </div>
                  </div>
                  '''
          
          html += '''
                  </div>
                  
                  <div class="footer">
                      <p>Reportes generados autom√°ticamente por GitHub Actions</p>
                      <p>Universidad Privada de Tacna - FAING EPIS</p>
                  </div>
              </div>
          </body>
          </html>
          '''
          
          with open('reports/snyk/dependencies.html', 'w', encoding='utf-8') as f:
              f.write(html)
          
          print("Snyk dependencies HTML report generated")
          EOFPY
            
            python convert-snyk-json-to-html.py
            cp snyk-test-results.json reports/snyk/
          fi
          
          # Copiar reportes de PITest desde artefactos descargados
          if [ -d pitest-reports ]; then
            echo "Copying PITest mutation reports from downloaded artifacts..."
            # Buscar archivos HTML dentro del directorio descargado
            find pitest-reports -name "*.html" -o -name "*.css" -o -name "*.js" | while read file; do
              cp "$file" reports/pitest/ 2>/dev/null || true
            done
            # Tambi√©n copiar toda la estructura si existe
            if [ -d pitest-reports/pit-reports ]; then
              cp -r pitest-reports/pit-reports/* reports/pitest/ 2>/dev/null || true
            fi
            # Si los archivos est√°n directamente en pitest-reports
            cp -r pitest-reports/* reports/pitest/ 2>/dev/null || true
            
            echo "PITest reports copied. Contents:"
            ls -la reports/pitest/ || echo "No files in reports/pitest/"
          else
            echo "‚ö†Ô∏è No PITest reports downloaded - creating placeholder"
            cat > reports/pitest/index.html << 'PITESTPLACEHOLDER'
          <!DOCTYPE html>
          <html lang="es">
          <head>
              <meta charset="UTF-8">
              <title>PITest Reports - Not Available</title>
              <style>
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      min-height: 100vh;
                      margin: 0;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  }
                  .container {
                      background: white;
                      padding: 40px;
                      border-radius: 12px;
                      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                      text-align: center;
                      max-width: 600px;
                  }
                  h1 { color: #2c3e50; margin-bottom: 20px; }
                  p { color: #666; line-height: 1.6; margin-bottom: 15px; }
                  .icon { font-size: 4em; margin-bottom: 20px; }
                  a {
                      display: inline-block;
                      margin-top: 20px;
                      padding: 12px 24px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      text-decoration: none;
                      border-radius: 6px;
                      transition: opacity 0.3s;
                  }
                  a:hover { opacity: 0.9; }
              </style>
          </head>
          <body>
              <div class="container">
                  <div class="icon">üß¨</div>
                  <h1>PITest Mutation Reports</h1>
                  <p><strong>Los reportes de mutation testing a√∫n no est√°n disponibles.</strong></p>
                  <p>Para generar los reportes:</p>
                  <ol style="text-align: left; display: inline-block;">
                      <li>Ejecuta el workflow "Complete Test Suite"</li>
                      <li>Espera a que complete las pruebas de mutaci√≥n</li>
                      <li>Este reporte se actualizar√° autom√°ticamente</li>
                  </ol>
                  <p><small>Los reportes se generan con PITest y muestran el mutation score del proyecto.</small></p>
                  <a href="../">‚Üê Volver al Dashboard</a>
              </div>
          </body>
          </html>
          PITESTPLACEHOLDER
          fi
          
          # Copiar reportes de BDD (Cucumber) si existen
          if [ -d bdd-reports ]; then
            echo "Copying BDD (Cucumber) reports..."
            
            # Copiar reportes de smoke tests
            if [ -d bdd-reports/smoke ]; then
              mkdir -p reports/bdd/smoke
              find bdd-reports/smoke -name "*.html" -o -name "*.css" -o -name "*.js" -o -name "*.json" | while read file; do
                cp "$file" reports/bdd/smoke/ 2>/dev/null || true
              done
              # Copiar estructura completa de cucumber-reports si existe
              if [ -d bdd-reports/smoke/proyecto/target/cucumber-reports ]; then
                cp -r bdd-reports/smoke/proyecto/target/cucumber-reports/* reports/bdd/smoke/ 2>/dev/null || true
              fi
            fi
            
            # Copiar reportes de regression tests
            if [ -d bdd-reports/regression ]; then
              mkdir -p reports/bdd/regression
              find bdd-reports/regression -name "*.html" -o -name "*.css" -o -name "*.js" -o -name "*.json" | while read file; do
                cp "$file" reports/bdd/regression/ 2>/dev/null || true
              done
              # Copiar estructura completa de cucumber-reports si existe
              if [ -d bdd-reports/regression/proyecto/target/cucumber-reports ]; then
                cp -r bdd-reports/regression/proyecto/target/cucumber-reports/* reports/bdd/regression/ 2>/dev/null || true
              fi
            fi
            
            echo "BDD reports copied. Contents:"
            ls -la reports/bdd/ || echo "No files in reports/bdd/"
          else
            echo "‚ö†Ô∏è No BDD reports downloaded - creating placeholder"
            mkdir -p reports/bdd
            cat > reports/bdd/index.html << 'BDDPLACEHOLDER'
          <!DOCTYPE html>
          <html lang="es">
          <head>
              <meta charset="UTF-8">
              <title>BDD Test Reports - Not Available</title>
              <style>
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                      display: flex;
                      justify-content: center;
                      align-items: center;
                      min-height: 100vh;
                      margin: 0;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                  }
                  .container {
                      background: white;
                      padding: 40px;
                      border-radius: 12px;
                      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                      text-align: center;
                      max-width: 600px;
                  }
                  h1 { color: #2c3e50; margin-bottom: 20px; }
                  p { color: #666; line-height: 1.6; margin-bottom: 15px; }
                  .icon { font-size: 4em; margin-bottom: 20px; }
                  a {
                      display: inline-block;
                      margin-top: 20px;
                      padding: 12px 24px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      text-decoration: none;
                      border-radius: 6px;
                      transition: opacity 0.3s;
                  }
                  a:hover { opacity: 0.9; }
                  .suite-links {
                      display: flex;
                      gap: 15px;
                      justify-content: center;
                      margin-top: 20px;
                  }
                  .suite-link {
                      padding: 10px 20px;
                      background: #f8f9fa;
                      color: #667eea;
                      border: 2px solid #667eea;
                      text-decoration: none;
                      border-radius: 6px;
                      transition: all 0.3s;
                  }
                  .suite-link:hover {
                      background: #667eea;
                      color: white;
                  }
              </style>
          </head>
          <body>
              <div class="container">
                  <div class="icon">ü•í</div>
                  <h1>BDD Test Reports (Cucumber)</h1>
                  <p><strong>Los reportes de pruebas BDD a√∫n no est√°n disponibles.</strong></p>
                  <p>Para generar los reportes:</p>
                  <ol style="text-align: left; display: inline-block;">
                      <li>Ejecuta el workflow "Complete Test Suite"</li>
                      <li>Espera a que complete las pruebas BDD (Smoke y Regression)</li>
                      <li>Este reporte se actualizar√° autom√°ticamente</li>
                  </ol>
                  <p><small>Los reportes se generan con Cucumber en formato Gherkin y muestran los escenarios ejecutados.</small></p>
                  <div class="suite-links">
                      <a href="smoke/" class="suite-link">Smoke Tests</a>
                      <a href="regression/" class="suite-link">Regression Tests</a>
                  </div>
                  <a href="../">‚Üê Volver al Dashboard</a>
              </div>
          </body>
          </html>
          BDDPLACEHOLDER
          fi
      
      # ============================================
      # CREATE DASHBOARD INDEX
      # ============================================
      - name: Create Reports Dashboard
        run: |
          cat > reports/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="es">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Security Reports Dashboard - Sistema Voluntariado UPT</title>
              <style>
                  * {
                      margin: 0;
                      padding: 0;
                      box-sizing: border-box;
                  }
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      min-height: 100vh;
                      padding: 20px;
                  }
                  .container {
                      max-width: 1200px;
                      margin: 0 auto;
                  }
                  .header {
                      text-align: center;
                      color: white;
                      margin-bottom: 50px;
                  }
                  .header h1 {
                      font-size: 3em;
                      margin-bottom: 10px;
                      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
                  }
                  .header p {
                      font-size: 1.2em;
                      opacity: 0.9;
                  }
                  .header .subtitle {
                      font-size: 1em;
                      margin-top: 5px;
                      opacity: 0.8;
                  }
                  .cards {
                      display: grid;
                      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                      gap: 30px;
                      margin-bottom: 40px;
                  }
                  .card {
                      background: white;
                      border-radius: 12px;
                      padding: 30px;
                      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                      transition: transform 0.3s, box-shadow 0.3s;
                      cursor: pointer;
                  }
                  .card:hover {
                      transform: translateY(-10px);
                      box-shadow: 0 15px 40px rgba(0,0,0,0.4);
                  }
                  .card-icon {
                      font-size: 3em;
                      margin-bottom: 20px;
                      text-align: center;
                  }
                  .card-title {
                      font-size: 1.5em;
                      font-weight: 600;
                      margin-bottom: 15px;
                      color: #2c3e50;
                      text-align: center;
                  }
                  .card-description {
                      color: #666;
                      line-height: 1.6;
                      margin-bottom: 20px;
                      text-align: center;
                  }
                  .card-links {
                      display: flex;
                      flex-direction: column;
                      gap: 10px;
                  }
                  .card-link {
                      display: block;
                      padding: 12px 20px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      text-decoration: none;
                      border-radius: 6px;
                      text-align: center;
                      transition: opacity 0.3s;
                      font-weight: 500;
                  }
                  .card-link:hover {
                      opacity: 0.9;
                  }
                  .card-link.secondary {
                      background: #f8f9fa;
                      color: #667eea;
                      border: 2px solid #667eea;
                  }
                  .info-section {
                      background: white;
                      border-radius: 12px;
                      padding: 30px;
                      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                      margin-bottom: 30px;
                  }
                  .info-section h2 {
                      color: #2c3e50;
                      margin-bottom: 20px;
                      font-size: 1.8em;
                  }
                  .info-section p {
                      color: #666;
                      line-height: 1.8;
                      margin-bottom: 15px;
                  }
                  .info-section ul {
                      margin-left: 20px;
                      color: #666;
                      line-height: 1.8;
                  }
                  .info-section ul li {
                      margin-bottom: 10px;
                  }
                  .badge {
                      display: inline-block;
                      padding: 5px 12px;
                      border-radius: 20px;
                      font-size: 0.85em;
                      font-weight: bold;
                      margin-right: 10px;
                      margin-bottom: 10px;
                  }
                  .badge-auto {
                      background: #28a745;
                      color: white;
                  }
                  .badge-weekly {
                      background: #17a2b8;
                      color: white;
                  }
                  .footer {
                      text-align: center;
                      color: white;
                      padding: 30px;
                      opacity: 0.9;
                  }
                  .footer a {
                      color: white;
                      text-decoration: underline;
                  }
                  @media (max-width: 768px) {
                      .header h1 {
                          font-size: 2em;
                      }
                      .cards {
                          grid-template-columns: 1fr;
                      }
                  }
              </style>
          </head>
          <body>
              <div class="container">
                  <div class="header">
                      <h1>üîí Security Reports Dashboard</h1>
                      <p>Sistema de Voluntariado UPT</p>
                      <p class="subtitle">An√°lisis automatizado de seguridad y calidad de c√≥digo</p>
                      <div style="margin-top: 20px;">
                          <span class="badge badge-auto">Actualizaci√≥n Autom√°tica</span>
                          <span class="badge badge-weekly">Escaneo Semanal</span>
                      </div>
                  </div>
                  
                  <div class="cards">
                      <div class="card">
                          <div class="card-icon">üîç</div>
                          <div class="card-title">Semgrep Analysis</div>
                          <div class="card-description">
                              An√°lisis est√°tico de c√≥digo con reglas de seguridad OWASP Top 10, 
                              SQL Injection, XSS, y mejores pr√°cticas de Java.
                          </div>
                          <div class="card-links">
                              <a href="semgrep/index.html" class="card-link">Ver Reporte HTML</a>
                              <a href="semgrep/semgrep-results.sarif" class="card-link secondary">Descargar SARIF</a>
                              <a href="semgrep/semgrep-results.json" class="card-link secondary">Descargar JSON</a>
                          </div>
                      </div>
                      
                      <div class="card">
                          <div class="card-icon">üõ°Ô∏è</div>
                          <div class="card-title">Snyk Code Analysis</div>
                          <div class="card-description">
                              An√°lisis de vulnerabilidades en el c√≥digo fuente con detecci√≥n 
                              de patrones inseguros y recomendaciones de remediaci√≥n.
                          </div>
                          <div class="card-links">
                              <a href="snyk/code.html" class="card-link">Ver Reporte HTML</a>
                              <a href="snyk/snyk-code-results.sarif" class="card-link secondary">Descargar SARIF</a>
                          </div>
                      </div>
                      
                      <div class="card">
                          <div class="card-icon">üì¶</div>
                          <div class="card-title">Snyk Dependencies</div>
                          <div class="card-description">
                              An√°lisis de vulnerabilidades conocidas (CVEs) en las dependencias 
                              del proyecto con severidad y enlaces a parches.
                          </div>
                          <div class="card-links">
                              <a href="snyk/dependencies.html" class="card-link">Ver Reporte HTML</a>
                              <a href="snyk/snyk-test-results.json" class="card-link secondary">Descargar JSON</a>
                          </div>
                      </div>
                      
                      <div class="card">
                          <div class="card-icon">‚òÅÔ∏è</div>
                          <div class="card-title">SonarCloud Analysis</div>
                          <div class="card-description">
                              An√°lisis completo de calidad y seguridad del c√≥digo con detecci√≥n de 
                              bugs, vulnerabilidades, code smells y security hotspots.
                          </div>
                          <div class="card-links">
                              <a href="sonarcloud/index.html" class="card-link">Ver Reporte HTML</a>
                              <a href="https://sonarcloud.io/project/overview?id=upt-epis_voluntariado-upt" class="card-link secondary" target="_blank">Ver en SonarCloud</a>
                          </div>
                      </div>
                      
                      <div class="card">
                          <div class="card-icon">üß¨</div>
                          <div class="card-title">PITest Mutation Testing</div>
                          <div class="card-description">
                              An√°lisis de efectividad de pruebas unitarias mediante mutation testing.
                              Eval√∫a la calidad de los tests introduciendo mutantes en el c√≥digo.
                          </div>
                          <div class="card-links">
                              <a href="pitest/index.html" class="card-link">Ver Reporte HTML</a>
                              <a href="https://pitest.org" class="card-link secondary" target="_blank">M√°s sobre PITest</a>
                          </div>
                      </div>
                      
                      <div class="card">
                          <div class="card-icon">ü•í</div>
                          <div class="card-title">BDD Tests (Cucumber)</div>
                          <div class="card-description">
                              Pruebas de comportamiento escritas en Gherkin que validan funcionalidades
                              desde la perspectiva del usuario final (Smoke y Regression).
                          </div>
                          <div class="card-links">
                              <a href="bdd/index.html" class="card-link">Ver Dashboard BDD</a>
                              <a href="bdd/smoke/" class="card-link secondary">Smoke Tests</a>
                              <a href="bdd/regression/" class="card-link secondary">Regression Tests</a>
                          </div>
                      </div>
                  </div>
                  
                  <div class="info-section">
                      <h2>‚ÑπÔ∏è Acerca de estos reportes</h2>
                      <p><strong>Generaci√≥n autom√°tica:</strong> Estos reportes se generan autom√°ticamente mediante GitHub Actions cada vez que:</p>
                      <ul>
                          <li>Se completa el workflow "Complete Test Suite" en la rama <code>main</code></li>
                          <li>Se ejecuta manualmente desde la pesta√±a Actions</li>
                          <li>Cada lunes a las 3 AM UTC (escaneo semanal programado)</li>
                      </ul>
                      
                      <p><strong>Herramientas utilizadas:</strong></p>
                      <ul>
                          <li><strong>Semgrep:</strong> An√°lisis est√°tico de c√≥digo con reglas personalizables (OWASP, security-audit, java)</li>
                          <li><strong>Snyk Code:</strong> Detecci√≥n de vulnerabilidades en c√≥digo fuente con contexto y remediaci√≥n</li>
                          <li><strong>Snyk Open Source:</strong> Escaneo de dependencias Maven para CVEs conocidos</li>
                          <li><strong>SonarCloud:</strong> An√°lisis completo de calidad, seguridad y mantenibilidad del c√≥digo</li>
                          <li><strong>PITest:</strong> Mutation testing para evaluar la efectividad de las pruebas unitarias (mutation score: 63%)</li>
                          <li><strong>Cucumber:</strong> Pruebas BDD con escenarios en formato Gherkin (Smoke Tests y Regression Tests)</li>
                      </ul>
                      
                      <p><strong>Repositorio:</strong> <a href="https://github.com/UPT-FAING-EPIS/proyecto-si784-2025-ii-u3-voluntariado_upt" target="_blank">UPT-FAING-EPIS/proyecto-si784-2025-ii-u3-voluntariado_upt</a></p>
                  </div>
                  
                  <div class="footer">
                      <p>Universidad Privada de Tacna - Facultad de Ingenier√≠a</p>
                      <p>Escuela Profesional de Ingenier√≠a de Sistemas</p>
                      <p>Curso: Calidad y Pruebas de Software</p>
                      <p style="margin-top: 10px; font-size: 0.9em;">
                          √öltima actualizaci√≥n: <span id="last-update"></span>
                      </p>
                  </div>
              </div>
              
              <script>
                  // Mostrar fecha de √∫ltima actualizaci√≥n
                  document.getElementById('last-update').textContent = new Date().toLocaleString('es-PE', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                      hour: '2-digit',
                      minute: '2-digit'
                  });
              </script>
          </body>
          </html>
          EOF
          
          echo "Dashboard created successfully"
      
      # ============================================
      # CREATE .nojekyll FILE
      # ============================================
      - name: Create .nojekyll
        run: |
          touch reports/.nojekyll
          echo "Created .nojekyll file to bypass Jekyll processing"
      
      # ============================================
      # UPLOAD ARTIFACTS
      # ============================================
      - name: Upload Reports as Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: security-reports-html
          path: reports/
          retention-days: 90
      
      # ============================================
      # DEPLOY TO GITHUB PAGES
      # ============================================
      - name: Setup Pages
        uses: actions/configure-pages@v4
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./reports
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
      
      # ============================================
      # NOTIFY SUCCESS
      # ============================================
      - name: Notify Deployment Success
        if: success()
        run: |
          echo "‚úÖ Security reports successfully deployed to GitHub Pages!"
          echo "üìä Dashboard URL: https://upt-faing-epis.github.io/proyecto-si784-2025-ii-u3-voluntariado_upt/"
          echo ""
          echo "Available reports:"
          echo "  - Semgrep: https://upt-faing-epis.github.io/proyecto-si784-2025-ii-u3-voluntariado_upt/semgrep/"
          echo "  - Snyk Code: https://upt-faing-epis.github.io/proyecto-si784-2025-ii-u3-voluntariado_upt/snyk/code.html"
          echo "  - Snyk Dependencies: https://upt-faing-epis.github.io/proyecto-si784-2025-ii-u3-voluntariado_upt/snyk/dependencies.html"
          echo "  - PITest Mutations: https://upt-faing-epis.github.io/proyecto-si784-2025-ii-u3-voluntariado_upt/pitest/"
          echo "  - BDD Tests: https://upt-faing-epis.github.io/proyecto-si784-2025-ii-u3-voluntariado_upt/bdd/"
